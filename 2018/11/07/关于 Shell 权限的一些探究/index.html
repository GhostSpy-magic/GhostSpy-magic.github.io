<!DOCTYPE html>
<html lang="zh-CN">










<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content>
    <meta name="author" content="John Doe">
    <meta name="keywords" content>
    <title>关于 Shell 权限的一些探究 ~ Hexo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.2/css/all.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/css/mdb.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1067060_vr10bjtg3us.css">
    
        <link rel="stylesheet" href="/css/Prettify/tomorrow-night-eighties.min.css">
    
</head>

<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/"><strong>Hexo</strong></a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">About</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2" style='background: url("https://i.imgur.com/oADD1Ip.jpg")no-repeat center center;background-size: cover;'>
    <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
        <div class="container text-center white-text wow fadeInUp">
            <p class="h2">关于 Shell 权限的一些探究</p>
            <br>
            
            <p>Wednesday, November 7th 2018, 5:14 pm</p>
            
        </div>
        </div>
    </div>
    </div>
  </header>

  <main>
  
  <div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2 ">
            <div class="post-content py-5 z-depth-3 main">
                <h2 id="0X00-前言"><a href="#0X00-前言" class="headerlink" title="0X00 前言"></a><strong>0X00 前言</strong></h2><p>几个月之前写的那篇 <a href="http://www.k0rz3n.com/2018/05/17/%E6%90%AD%E5%BB%BAdocker%E7%9A%84%20CTF%20getshell%E7%8E%AF%E5%A2%83/" target="_blank" rel="noopener">搭建docker的 CTF getshell环境</a> 由于其中写了一句：“因为这里涉及到权限的问题，比较复杂，我会更新这篇文章或者新开一篇文章”，期间也有很多人问我这个问题，于是还是决定亲自再测试一下，搞一搞这里面权限应该怎么设置，为什么要这样设置，也算是给自己和他人一个交代，谁让我承诺了呢？</p>
<h2 id="0X01-Linux下的权限管理"><a href="#0X01-Linux下的权限管理" class="headerlink" title="0X01 Linux下的权限管理"></a><strong>0X01 Linux下的权限管理</strong></h2><h3 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1.基本概念"></a><strong>1.基本概念</strong></h3><p>权限是操作系统用来限制资源访问的机制，权限一般分为读、写、执行。Linux 系统中每个文件都拥有自己所属用户及所属组，并且通过10个字符表明了那些用户和用户组能有权对该文件进行哪些操作。</p>
<a id="more"></a>
<blockquote>
<p><strong>注意：</strong></p>
<p>(1)每个进程都是以某个用户的身份运行，所以进程的权限与该用户的权限一样，用户的权限越大，该进程所拥有的权限也就越大。<br>(2)文件的所属用户就是创建文件的用户(或者说创建文件的进程所属的用户)，文件的所属组就是文件的所属用户所在的组<br>(3)如果我们无法改变用户的访问权限(实际上通常情况下无法改变)，我们控制权限的实质实际上就转化成了改变文件的所属，这样其他用户组的用户就对该文件没有了访问权限<br>(4)Linux 中每一个用户都必须属于一个用户组，无一例外</p>
</blockquote>
<h3 id="2-常用的命令"><a href="#2-常用的命令" class="headerlink" title="2.常用的命令"></a><strong>2.常用的命令</strong></h3><p>我们在Linux 中有一些比较常用的查看当前进程所属用户和用户组的命令</p>
<h4 id="1-cat-etc-group"><a href="#1-cat-etc-group" class="headerlink" title="1.cat /etc/group"></a><strong>1.cat /etc/group</strong></h4><p>查看当前有哪些用户组存在</p>
<pre><code>root@8235174cc513:/var/www/html# cat /etc/group
root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
adm:x:4:
tty:x:5:
disk:x:6:
lp:x:7:
mail:x:8:
news:x:9:
uucp:x:10:
man:x:12:
proxy:x:13:
kmem:x:15:
dialout:x:20:
fax:x:21:
voice:x:22:
cdrom:x:24:
floppy:x:25:
tape:x:26:
sudo:x:27:
audio:x:29:
dip:x:30:
www-data:x:33:
backup:x:34:
operator:x:37:
list:x:38:
irc:x:39:
src:x:40:
gnats:x:41:
shadow:x:42:
utmp:x:43:
video:x:44:
sasl:x:45:
plugdev:x:46:
staff:x:50:
games:x:60:
users:x:100:
nogroup:x:65534:
ssl-cert:x:101:
</code></pre><h4 id="2-groups"><a href="#2-groups" class="headerlink" title="2.groups"></a><strong>2.groups</strong></h4><p>查看当前进程所属用户所在的用户组</p>
<pre><code>root@8235174cc513:/var/www/html# groups
root
</code></pre><p>这说明我现在所在的进程的所属用户是 root 组的，如果想看是属于这个组中的什么用户可以使用 whoami </p>
<pre><code>(www-data:/var/www/html) $ groups
www-data
</code></pre><p>这个就是说明我启动这个进程的用户所属的组是 www-data</p>
<p>那比如说我想在 www-data 组中添加一个用户</p>
<pre><code>useradd -g www-data K0rz3n
</code></pre><p>然后我们将我们的用户切换到 K0rz3n</p>
<pre><code>su K0rz3n
</code></pre><p>然后我们看一下 whoami 和 groups 的结果</p>
<pre><code>$ whoami
K0rz3n

$ groups
www-data
</code></pre><p>当然我们可以指定用户去查看其所属的用户组</p>
<pre><code>root@8235174cc513:/# groups K0rz3n
K0rz3n : www-data
</code></pre><blockquote>
<p><strong>注意：</strong></p>
<p>除了 groups 以外 id 这个命令也有着和 groups 一样的效果，如下所示</p>
</blockquote>
<pre><code>root@8235174cc513:/# id
uid=0(root) gid=0(root) groups=0(root)
root@8235174cc513:/# id K0rz3n
uid=1000(K0rz3n) gid=33(www-data) groups=33(www-data)
</code></pre><h4 id="3-ls-la"><a href="#3-ls-la" class="headerlink" title="3.ls -la"></a><strong>3.ls -la</strong></h4><p>这个命令能查看当前目录中所有文件的属主和属组，并且能根据最前面的 10个字符判断其他组的用户对当前文件所拥有的权限</p>
<pre><code>root@8235174cc513:/var/www/html# ls -la
total 16
drwxr-xr-x 2 root root 4096 Nov  7 06:23 .
drwxr-xr-x 3 root root 4096 Nov  7 05:55 ..
-rw-r--r-- 1 root root   32 Nov  7 06:23 index.php
-rw-r--r-- 1 root root   29 Nov  7 06:23 qweasdzxc.php
</code></pre><p><strong>解释一下两个 root</strong></p>
<p>其中这两个 root 的前一个表示这个文件属于 root 用户组，后一个表示这个文件属于 root 用户所有，连起来就是这个文件的归属为 root 用户组下面的 root 用户</p>
<p><strong>然后解释一下前面的10个字符</strong></p>
<p>(1)第一个字符表示这个文件的属性 是目录(d) 文件(-) 还是连接(l) 还是块设备(b) 等<br>(2)后面三个字符表示的是这个文件的拥有者(也就是两个 root 的后一个) <strong>对这个文件的操作权限</strong><br>(3)中间三个字符表示的是与这个文件的拥有者在同一个用户组的用户<strong>对这个文件的操作权限</strong><br>(4)最后三个字符表示的是其他用户组中的用户<strong>对这个文件的操作权限</strong></p>
<p>我为什么把“对这个文件的操作权限”几个字加粗，实际上我想表达的是，我们所谓的控制权限实质上就是改变文件的属组和属主，让他和想操作这个文件的用户所起的进程不是一个用户，不在一个属组，然后再对这个文件配置 755 或者 644 之类的权限，剥夺其他用户组的用户的修改权限或者执行权限，这样就达到了我们控制权限的目的</p>
<h2 id="0X02-如何控制-Shell-的权限"><a href="#0X02-如何控制-Shell-的权限" class="headerlink" title="0X02 如何控制 Shell 的权限"></a><strong>0X02 如何控制 Shell 的权限</strong></h2><p>上面说那么多关于权限的问题，我们还是回归到我们的 Shell 上面来，我们首先可以自己测试一下 Shell 的权限，使用 whoami ，我发现是 www-data 权限，查了一下资料，发现 php-fpm 似乎默认就是 www-data 的权限</p>
<p>然后如果我们的 web 目录的所属用户就是 www-data 的话，那就比较危险，但是往往不是这样的，我看了一下我的 web 目录的所属组合用户都是 root ，也就是说它和我们的 shell 的用户所在的用户组根本不一样 ，那我们只要控制好三个数字中的最后一个为 4 就比较安全了，然后我看了一下文件权限设置为 644  ，这样就完全不用设置。</p>
<p>但是如果真的你的 web 目录的所属用户和 Shell 所属的用户真的就是一个的话，那么一定要对 web 目录的文件的所属用户和用户组进行修改（毕竟我们没法改变 shell 的权限，我们只能选择修改 web 目录的权限），这里使用我上<a href="http://www.k0rz3n.com/2018/05/17/%E6%90%AD%E5%BB%BAdocker%E7%9A%84%20CTF%20getshell%E7%8E%AF%E5%A2%83/" target="_blank" rel="noopener">一篇文章</a>的方法就好了。</p>
<h2 id="0X03-总结"><a href="#0X03-总结" class="headerlink" title="0X03 总结"></a><strong>0X03 总结</strong></h2><p>对于权限问题，其实并没有相像的复杂，只要沉下心来稍微分析一下就很快能弄清楚啦，这篇文章也算是了了我的一个心愿。</p>

                <hr>
                <div>
                    <p>
                         
                        <span class="badge badge-light">#&nbsp;备忘 shell Linux</span>
                        &nbsp;
                        
                    </p>
                </div>
                <br>
                
                    <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
                
            </div>
        </div>
        <div class="d-none d-md-block col-md-2">
            
  <div id="toc" class="py-5">
    <p class="h6"><i class="iconfont icon-toc" style="vertical-align:middle"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>        
</div>

<br><br><br>

<!-- Comments -->
<div class="comments" id="comments">
 
</div>
  
  </main>

<footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank"><b>HEXO</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank"> <b>Material-T</b></a>
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/jquery-3.3.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.7.4/js/mdb.min.js"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    
    <script src="/js/post.js"></script>
    
      <script src="/js/plugins/prettify.js"></script>
      <script>
          $(document).ready(function(){
              $('pre').addClass('prettyprint linenums');
              prettyPrint();
          })
      </script>
    
  
</body>
</html>